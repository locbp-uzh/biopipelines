# BioPipelines Configuration
# This file defines folder paths and default environments for pipeline execution
# Users can customize this file to match their local setup
#
# Placeholder syntax: <key> references another folder key
# Resolution order: base -> infrastructure -> shared_overrides (if shared) -> repositories -> cache -> derived -> server
# Runtime placeholders: <user>, <cwd>, <shared_user> are injected at runtime

# Folder Configuration
folders:
  # Base paths (resolved first)
  # Runtime placeholders: <username>, <cwd>
  # - <username>: actual username (e.g., gquarg)
  # - <cwd>: current working directory
  base:
    home: "/home/<username>"
    data: "<home>/data"
    scratch: "/scratch/<username>"
    group: "/shares/locbp.chem.uzh"
    user: "<group>/<username>"
    biopipelines: "<cwd>"
    biopipelines_output: "<user>/BioPipelines"

  # Infrastructure paths
  infrastructure:
    HelpScripts: "<biopipelines>/HelpScripts"
    PDBs: "<biopipelines>/PDBs"
    Ligands: "<biopipelines>/Ligands"
    cache: "<group>/cache"
    containers: "<group>/containers"

  # Installation files
  repositories:
    RFdiffusion: "<data>/RFdiffusion"
    RFdiffusionAllAtom: "<data>/rf_diffusion_all_atom"
    RFdiffusion3: "<data>/rfdiffusion3"
    ProteinMPNN: "<data>/ProteinMPNN"
    LigandMPNN: "<data>/LigandMPNN"
    AlphaFold: "<data>/localcolabfold"

    Boltz: "<data>/boltz"
    BoltzGen: "<data>/boltzgen"
    GhostFold: "<data>/ghostfold"
    MMseqs2: "<data>/mmseqs"
    ModelForge: "<data>/modelforge"
    Gnina: "<data>/gnina"

  # Cache paths (shared on group storage)
  cache:
    BoltzCache: "<cache>/Boltz"
    BoltzGenCache: "<cache>/BoltzGen"
    ColabFoldDatabases: "<group>/models/colabfold_databases"
    MMseqs2Databases: "<group>/models/mmseqs2_databases/gpu"

  # Server paths
  server:
    MMseqs2Server: "<biopipelines_output>/MMseqs2Server"

# Default Environments
# Each tool can have a default conda environment specified here
# If no specific model is used, the default is biopipelines containing pyyaml and pandas (it is automatically created when submitting via submit)
# If the tool itsef manages the change to an environment (e.g. when it needs more than one environment), set it to null
environments:
  # Structure generation
  RFdiffusion: "SE3nv"
  RFdiffusionAllAtom: "SE3nv"
  RFdiffusion3: "foundry"
  BoltzGen: "boltzgen"
  BoltzGenMerge: "boltzgen"
  BoltzGenImport: "boltzgen"

  # Sequence design
  ProteinMPNN: "SE3nv"
  LigandMPNN: "ligandmpnn_env"
  MutationComposer: "MutationEnv"
  Mutagenesis: "MutationEnv"
  Fuse: "biopipelines"
  StitchSequences: "biopipelines"
  SplitChains: "biopipelines"
  DNAEncoder: "biopipelines"
  RBSDesigner: "rbs_designer"

  # Structure prediction
  AlphaFold: "biopipelines"
  GhostFold: "ghostfold"
  Boltz2: "Boltz2Env"
  RF3: "modelforge"

  # Analysis
  Gnina: "biopipelines"
  Distance: "biopipelines"
  DistanceSelector: "biopipelines"
  ConformationalChange: "ProteinEnv"
  MutationProfiler: "MutationEnv"
  SequenceMetricCorrelation: "MutationEnv"
  BayesianAdjuster: "MutationEnv"
  Contacts: "ProteinEnv"
  PoseChange: "ProteinEnv"
  SASA: "ProteinEnv"

  # Data management
  Panda: "biopipelines"
  ExtractMetrics: "biopipelines"
  SelectionEditor: "ProteinEnv"

  # Utilities
  Load: "biopipelines"
  MMseqs2: "biopipelines"
  MMseqs2Server: "biopipelines"
  CompoundLibrary: "biopipelines"
  PDB: "biopipelines"
  Ligand: "biopipelines"
  Sequence: "biopipelines"
  PyMOL: "ProteinEnv"
  Plot: "biopipelines"

# Containers
# Singularity/Apptainer container images for tools that use containerized execution
# When a container is configured for a tool, it will be used instead of the conda environment
containers:
  # Add container paths here as needed
  # Example: ToolName: "<containers>/tool.sif"
  #RFdiffusionAllAtom: "<RFdiffusionAllAtom>/rf_se3_diffusion.sif"

# Cluster / Site Configuration
# Settings that vary between computing environments (HPC clusters, local machines)
# Modify these when deploying BioPipelines on a new system
cluster:
  # Email mapping: Unix username -> notification email
  # Used by SLURM submissions with email="auto"
  # Add your username and email here for automatic SLURM notifications
  emails:
    gquarg: "gianluca.quargnali@chem.uzh.ch"

  # Environment manager: "mamba" or "conda"
  # Controls shell hook initialization and environment activation commands
  env_manager: "mamba"

  # Container executor: "apptainer" or "singularity"
  # Used for tools that run inside containers (e.g., RFdiffusionAllAtom)
  container_executor: "apptainer"

  # Module load commands for SLURM scripts
  # These are executed at the top of SLURM wrapper scripts (slurm.sh)
  # Set to [] if your system does not use the module system
  slurm_modules:
    - "miniforge3"
    - "apptainer"

# GNINA-specific runtime configuration
# CUDA modules and library paths needed for GNINA's CNN scoring.
# Adjust these to match your HPC environment.
gnina:
  modules:
    - "cuda/12.6.3"
    - "cudnn/9.8.0.87-12"
  ld_library_path: "/apps/u24/opt/x86_64_v3/cuda-12.6.3-ok2c7hqa5kefkh3iyolgxrajfpepvh6h/targets/x86_64-linux/lib"
